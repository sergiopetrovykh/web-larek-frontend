# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

***Архитектура приложения***

Архитектура приложения "Веб-ларек" построена вокруг классического подхода с разделением на три основные слои: Model (Модель), View (Представление), и Presenter (Презентер). В этом приложении добавлен дополнительный слой EventDispatcher (Посредник событий), который служит для связи между этими слоями, что позволяет разделить логику и обеспечить гибкость приложения.
Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.
 

***Основные компоненты:***

Model (Модель)
Модель отвечает за управление данными и бизнес-логикой. В проекте она представлена такими классами, как Product и AppState. Эти классы хранят данные о состоянии приложения (например, каталог продуктов, корзина, информация о заказе) и предоставляют методы для работы с этими данными. Модель также содержит методы для уведомления других частей системы о произошедших изменениях, используя события.

Product — управляет данными о продукте.

AppState — управляет состоянием всего приложения, включая каталог, корзину, предпросмотр товаров, и информацию о заказе.

View (Представление)
Представление отвечает за отображение интерфейса пользователя. Это слой, который взаимодействует с DOM и отображает данные, полученные из модели. Представление также обрабатывает пользовательские действия, такие как клики, ввод данных в формы и т.д.

Page — основной класс, управляющий элементами интерфейса страницы, включая каталог и корзину.
Card — отображает информацию о продукте в виде карточки.
Modal — отображает модальные окна, например, для предпросмотра товара.
Form — обрабатывает и управляет формами, такими как форма доставки или контактная форма.

Presenter (Презентер)
Презентер связывает модель и представление, обеспечивая их взаимодействие. Он не просто передает данные из модели в представление, но и контролирует логику обработки пользовательских действий, обновление модели и повторное отображение измененных данных.

EventDispatcher (Посредник событий)
Посредник событий — это центральный элемент, который обеспечивает обмен сообщениями между разными компонентами приложения, не требуя прямой связи между ними. Это позволяет создавать более слабо связанные компоненты, что упрощает их тестирование, замену и повторное использование.

Цепочка действий:
Цепочка действий в приложении начинается с пользовательского взаимодействия с представлением (View), после чего событие передается в презентер (EventDispatcher), который управляет этим событием и решает, какие действия предпринять. Например, пользователь кликает на карточку товара:

View (Представление): Пользователь кликает по карточке товара (класс Card), что вызывает событие клика.
Presenter (Презентер): Класс Card передает это событие через EventDispatcher, который вызывает событие card:select и передает в него данные о выбранном товаре.
Model (Модель): Событие обрабатывается и данные товара передаются в модель (класс AppState), где они сохраняются и вызывается событие изменения модели (preview:changed).
Presenter (Презентер): Событие preview:changed снова передается через EventDispatcher, который инициирует открытие модального окна с информацией о товаре.
View (Представление): Класс Modal получает данные товара и отображает их в модальном окне.
Таким образом, приложение выстраивает цепочку действий, начиная с представления (View), переходя через презентер (Presenter) к модели (Model), и снова возвращаясь к представлению для обновления интерфейса.

### Базовый код

***
***Класс Api — Реализует базовые HTTP-запросы.***
Класс Api является базовым классом для осуществления HTTP-запросов к удалённому серверу. Он предоставляет обобщённый и универсальный интерфейс для взаимодействия с API, позволяя выполнять различные типы запросов (GET, POST, PUT, DELETE) с учётом параметров и обработки ответов. Этот класс служит основой для создания специализированных API-клиентов, которые могут расширять его функциональность для конкретных потребностей приложения.

Конструктор:

constructor(apiUrl: string, requestParams: RequestInit = {}) — принимает базовый URL для API.
- apiUrl: Базовый URL для API.
- requestParams: Параметры запроса для fetch.

Свойства:

- readonly apiUrl: string — базовый URL для запросов к API.
- protected requestParams: RequestInit — параметры запроса для fetch к API, заданные по умолчанию; при передаче они включаются в requestParams.

Методы:

- protected processResponse(response: Response) — обрабатывает ответы от сервера. Если ответ успешный (response.ok), то возвращает данные в формате JSON; в противном случае, генерирует сообщение об ошибке.
- fetchGet(endpoint: string) — формирование HTTP-запросов методом GET.
- sendRequest(endpoint: string, payload: object, method: HttpMethods = "POST") — формирование HTTP-запросов к серверу с использованием одного из методов, перечисленных в типе HttpMethods ("POST", "PUT", "DELETE").

***
***Класс EventDispatcher implements IEvents***

Брокер событий нужен для управления событиями в приложении. Он действует как посредник, который помогает организовывать взаимодействие между различными компонентами системы через механизм событий.

Свойства:

- eventMap: Map — список событий.

Конструктор:

constructor() — инициализирует eventMap как карту для управления подписками на события.

Методы:

- subscribe — добавляет событие и его обработчик в список событий.
- unsubscribe — удаляет событие и его обработчик из списка событий.
- dispatch — вызывает событие и передает необходимые данные его обработчику.
- subscribeAll — подписывает на все события.
- unsubscribeAll — удаляет все подписки на события.
- triggerEvent — создает событие с заданными аргументами и вызывает его обработчики.

***
***Класс UIComponent***

Абстрактный класс, предназначенный для создания компонентов пользовательского интерфейса. Наследуется всеми классами, представляющими элементы интерфейса (View).

Свойства:

- readonly rootElement: HTMLElement — основной DOM-элемент компонента.

Конструктор:

constructor(container: HTMLElement) — принимает контейнерный элемент, в который будет встроен компонент.

Методы:

- toggleCssClass(element: HTMLElement, className: string) — переключает наличие класса CSS на элементе.
- setTextContent(element: HTMLElement, text: string) — устанавливает текстовое содержимое элемента.
- setElementDisabled(element: HTMLElement, isDisabled: boolean) — изменяет состояние блокировки элемента.
- protected hideElement(element: HTMLElement) — скрывает элемент на странице.
- showElement(element: HTMLElement) — делает элемент видимым.
- setElementImage(element: HTMLElement, src: string, altText?: string) — устанавливает изображение на элемент с альтернативным текстом.
renderComponent(data?: any) — рендерит компонент, используя переданные данные.

Описание:

Класс UIComponent служит основой для создания компонентов пользовательского интерфейса. Он предоставляет общие методы для управления состоянием и внешним видом элементов DOM, такие как переключение CSS-классов, установка текста или изображений, и управление видимостью или доступностью элементов. Эти методы позволяют эффективно управлять компонентами интерфейса, обеспечивая гибкость и удобство в разработке.

***
***Класс DataModel***

Абстрактный класс для создания и управления данными модели.

Свойства:

protected readonly rootElement: HTMLElement — корневой DOM-элемент, связанный с моделью.

Конструктор:

constructor(data: Partial, eventDispatcher: IEvents) — принимает начальные данные для модели и объект EventDispatcher для уведомления о изменениях в модели.
- data: Начальные данные модели.
- eventDispatcher: Объект для управления событиями.


Методы:

- notifyChange(event: string, payload?: object) — генерирует событие с указанным именем и переданными данными, уведомляя всех подписчиков об изменении данных модели.

Описание:

DataModel — это базовый класс, предназначенный для работы с данными в приложении. Он помогает управлять состоянием данных и уведомлять другие компоненты об изменениях через события. Этот класс используется для создания моделей данных, которые могут отслеживать и оповещать другие части приложения о том, что данные были изменены.

***
***LarekAPI***
LarekAPI расширяет базовый класс Api, предоставляя специализированные методы для взаимодействия с API магазина. Он включает функции для получения списка продуктов, информации о конкретных товарах и обработки заказов.

Свойства:

imageBaseURL: string — базовый URL для загрузки изображений продуктов.

Конструктор:

constructor(imageBaseURL: string, apiUrl: string, requestParams?: RequestInit) — устанавливает базовый URL для API и URL для загрузки изображений.
- imageBaseURL: URL для загрузки изображений.
- apiUrl: URL для API.
- requestParams: Параметры запроса.


Методы:

- fetchProductList(): Promise<IProduct[]> — получение списка всех продуктов с сервера.
- fetchProductDetails(id: string): Promise<IProduct> — получение подробной информации о продукте по его ID.
- submitOrder(order: IOrder): Promise<IOrderResult> — отправка информации о заказе на сервер и получение результата.

Описание:

LarekAPI — это класс, который наследует базовую функциональность Api и добавляет методы, специфичные для работы с магазином. Он позволяет получать список доступных продуктов, просматривать информацию о каждом продукте и отправлять заказы. Этот класс служит интерфейсом между вашим приложением и сервером, обеспечивая доступ к данным и функционалу магазина.

***Компоненты моделей данных***

***
***Класс ProductModel***

Наследуется от DataModel<IProduct>.

Этот класс предназначен для создания и управления данными о продукте. Он предоставляет структуру для хранения и обработки информации о продукте, что может быть использовано как для отображения на пользовательском интерфейсе, так и для обработки в бизнес-логике.

Конструктор:

Конструктор наследуется от DataModel.
Свойства:

- productId: string — уникальный идентификатор продукта.
- name: string — название продукта.
- cost: number | null — цена продукта, может быть не указана.
- details: string — описание продукта.
- productCategory: string — категория продукта.
- imageUrl: string — ссылка на изображение продукта.
Методы:

Все методы наследуются из DataModel.
Описание:

ProductModel — это класс, который управляет данными о продукте, такими как идентификатор, название, цена, описание и категория. Эти данные могут быть использованы для отображения продукта на сайте или в приложении, а также для выполнения бизнес-логики, связанной с продуктами. Класс наследует методы и функциональность от базовой модели, что упрощает работу с данными и их обновление.

***
***Класс AppStateModel***

Наследуется от DataModel<IAppState>.

Этот класс представляет собой центральную модель для управления состоянием приложения. Он отвечает за хранение и управление данными каталога продуктов, содержимым корзины, информацией о заказе, а также за обработку ошибок валидации форм.

Конструктор:

Конструктор наследуется от DataModel.
Свойства:

- productCatalog: ProductModel[] — массив объектов продуктов в каталоге.
- shoppingCart: ProductModel[] — массив объектов продуктов в корзине.
- orderData: IOrderData — объект с данными о текущем заказе.
- productPreview: string | null — идентификатор товара, который отображается в предпросмотре.
- formValidationErrors: FormValidationErrors — объект, содержащий ошибки валидации форм.

Методы:

Все методы наследуются из DataModel.
- emptyCart() — очищает корзину и вызывает соответствующее событие.
- clearOrderData() — очищает данные о заказе.
- updateCatalog(products: IProductData[]) — устанавливает каталог продуктов, преобразуя каждый элемент в экземпляр ProductModel, и инициирует событие обновления каталога.
- setProductPreview(productId: string | null) — устанавливает товар для предпросмотра и инициирует событие изменения предпросмотра.
- addItemToCart(product: ProductModel) — добавляет товар в корзину.
removeItemFromCart(productId: string) — удаляет товар из корзины по его идентификатору.
- refreshCartState() — обновляет текущее состояние корзины.
- updateDeliveryField(field: string, value: any) — обновляет значение поля в данных о доставке, при успешной валидации инициирует событие готовности данных.
- updateContactField(field: string, value: any) — обновляет значение поля в данных о контактах заказа, при успешной валидации инициирует событие готовности данных.
- validateDeliveryFields() — проверяет корректность данных о доставке.
- validateContactFields() — проверяет корректность данных о контактах.

Описание:

AppStateModel — это класс, который управляет основным состоянием приложения, включая каталог продуктов, корзину, информацию о заказе и ошибки валидации форм. Он предоставляет методы для управления этими данными и их обновления, обеспечивая централизованный контроль за состоянием. Это упрощает работу с приложением и поддерживает согласованность данных во всех компонентах.


***Общие компоненты представления***
***
***Класс Modal***

Класс для управления модальным окном: его открытием, закрытием и содержимым. Наследуется от UIComponent<IModalData>.

Конструктор:

constructor(container: HTMLElement, eventDispatcher: IEvents) — принимает элемент-контейнер для модального окна и объект для управления событиями.
- container: Контейнер модального окна.
- eventDispatcher: Объект для управления событиями.

Методы:

- setContent(content: string | HTMLElement) — задает содержимое модального окна.
- openModal() — открывает модальное окно и генерирует событие его открытия.
- closeModal() — закрывает модальное окно и генерирует событие его закрытия.
- renderModal(data?: IModalData) — рендерит модальное окно с переданным содержимым и открывает его.

***
***Класс Form***

Класс для создания и управления формами. Обрабатывает события ввода и отправки, а также управляет валидностью и отображением формы. Наследуется от UIComponent<IFormState>.

Конструктор:

constructor(container: HTMLFormElement, eventDispatcher: IEvents) — принимает элемент-контейнер формы и объект для управления событиями.
- container: Контейнер формы.
- eventDispatcher: Объект для управления событиями.

Методы:

- handleInputChange(event: Event) — обработчик событий ввода, генерирующий события изменения для каждого поля в форме.
- set isValid(isValid: boolean) — контролирует активность кнопки отправки в зависимости от валидности формы.
- set validationErrors(errors: FormErrors) — устанавливает и отображает ошибки валидации формы.
- renderForm() — отображает форму, устанавливает её валидность, обрабатывает ошибки и задает значения полей.

***
***Класс Page***

Класс Page управляет основными элементами интерфейса страницы, такими как счетчик корзины, каталог продуктов и общая обертка страницы. Наследуется от UIComponent<IPage>.

Свойства:

- _basketCounter: HTMLElement — элемент для отображения количества товаров в корзине.
- _productCatalog: HTMLElement — контейнер для элементов каталога продуктов.
- _pageWrapper: HTMLElement — обертка страницы.
- _shoppingBasket: HTMLElement — элемент корзины.

Конструктор:

constructor(container: HTMLElement, eventDispatcher: IEvents) — инициализирует элементы страницы и назначает обработчики событий.
- container: Контейнер страницы.
- eventDispatcher: Объект для управления событиями.


Методы:

- set basketCount(value: number) — обновляет количество товаров в корзине.
- set productCatalog(items: HTMLElement[]) — заполняет каталог продуктами.
- set pageLocked(isLocked: boolean) — управляет блокировкой страницы.

***
***Класс Card***

Класс Card предназначен для отображения и управления карточками товара. Он управляет информацией о продукте, такой как название, описание, цена и изображение. Наследуется от UIComponent<ICard>.

Свойства:

- _itemIndex: number — порядковый номер продукта в корзине.
- _productName: string — название продукта.
- _productDescription: string — описание продукта.
- _productCategory: string — категория продукта.
- _productPrice: number | null — цена продукта.
- _productImage: string — URL изображения продукта.
- _actionButton: HTMLElement — кнопка действия на карточке продукта.
- _buttonLabel: string — текст кнопки действия.

Конструктор:

constructor(container: HTMLElement, actions?: IActions) — инициализирует элементы карточки и устанавливает обработчики событий для кнопок.

Методы:

- disablePurchaseButton() — делает кнопку покупки неактивной, если цена не указана.
- get productId(): string / set productId(value: string) — управляет идентификатором карточки.
- get productName(): string / set productName(value: string) — управляет названием товара.
- get productPrice(): number | null / set productPrice(value: number | null) — управляет ценой товара.
- get productCategory(): string / set productCategory(value: string) — управляет категорией товара и ее отображением.
- set productImage(src: string) — устанавливает изображение товара.
- set productDescription(text: string) — устанавливает описание товара.
- set actionButtonLabel(label: string) — устанавливает текст на кнопке действия.

***
***Класс Basket***

Класс Basket предназначен для отображения и управления компонентом корзины покупок. Обеспечивает отображение товаров, управление их выбором и расчет общей стоимости. Наследуется от UIComponent<IBasketView>.

Свойства:

- _itemList: HTMLElement — элемент для списка товаров в корзине.
- _totalAmount: HTMLElement — элемент для отображения общей стоимости товаров.
- _checkoutButton: HTMLButtonElement — кнопка для перехода к оформлению заказа.

Конструктор:

constructor(container: HTMLElement, eventDispatcher: IEvents) — инициализирует элементы управления корзиной и подписывается на события.
- container: Контейнер корзины.
- eventDispatcher: Объект для управления событиями.

Методы:

- toggleCheckoutButton(isEnabled: boolean) — включает или выключает кнопку оформления заказа в зависимости от наличия товаров в корзине.
- set basketItems(items: HTMLElement[]) — устанавливает товары в корзине.
- set totalAmount(value: number) — устанавливает и отображает общую стоимость товаров в корзине.

***
***Класс DeliveryForm***

Класс DeliveryForm предназначен для отображения и управления формой доставки. Включает элементы для выбора способа оплаты и ввода адреса доставки. Наследуется от Form<IDeliveryForm>.

Свойства:

- _cardPaymentButton: HTMLElement — кнопка выбора оплаты картой.
- _cashPaymentButton: HTMLElement — кнопка выбора оплаты наличными.

Конструктор:

constructor(container: HTMLFormElement, eventDispatcher: IEvents, actions?: IActions) — инициализирует элементы формы и устанавливает обработчики событий.

Методы:

togglePaymentButtons(isCardSelected: boolean) — переключает активное состояние кнопок выбора способа оплаты.
set deliveryAddress(value: string) — устанавливает адрес доставки.

***
***Класс ContactForm***

Класс ContactForm предназначен для отображения и управления формой контактных данных, включая ввод телефона и электронной почты. Наследуется от Form<IContactForm>.

Конструктор:

constructor(container: HTMLFormElement, eventDispatcher: IEvents) — принимает контейнер формы и объект для управления событиями.
- container: Контейнер формы.
- eventDispatcher: Объект для управления событиями.

Методы:

- set phoneNumber(value: string) — устанавливает номер телефона.
- set emailAddress(value: string) — устанавливает адрес электронной почты.

***
***Класс Success***

Класс Success предназначен для отображения сообщения об успешной операции, например, после оформления заказа. Наследуется от UIComponent<ISuccess>.

Свойства:

- _closeButton: HTMLElement — кнопка для закрытия сообщения об успешной операции.
- _totalElement: HTMLElement — элемент для отображения информации о списанных средствах или других деталях успешной операции.

Конструктор:

constructor(container: HTMLElement, actions: ISuccessActions) — инициализирует элементы интерфейса и назначает обработчики событий.

Методы:

- set transactionDetails(details: string) — устанавливает текст, отображаемый в элементе _totalElement. Используется для обновления информации о стоимости или других данных, связанных с успешным завершением операции.


## Ключевые типы данных

### Типы данных для базовых классов:

#### Общие методы события:

`
interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void; - обработчик события
    emit<T extends object>(event: string, data?: T): void; - инициатор события
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void; - функция колбек для события
}
`

#### Данные ответа от сервера:

`
type ApiListResponse<Type> = {
    total: number, - общая стоимость товаров
    items: Type[] - список заказанных товаров
};
`

#### Методы запросов к серверу:

`
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';
`

### Типы данных для общих компонентов:

### Данные обработчика валидности формы:

`
interface IFormState {
    valid: boolean; - валидность всей формы
    errors: string[]; - ошибки валидации формы
}
`

#### Данные контента для отрисовки внутри модального окна:

`
interface IModalData {
    content: HTMLElement; - элемент HTML, который будет отображаться внутри модального окна.
}
`

#### Остальные типы данных:
#### Товар:

`
interface IProduct {
    id: string; - id товара
    category: string; - категория товара
    image: string; - изображение товара
    title: string; - имя товара
    description: string; - описание товара
    price: number | null; - цена товара
}
`

#### Состояние приложения:

`
interface IAppState {
    catalog: IProduct[]; - все товары в каталоге
    basket: IProduct[]; - все id товаров в корзине
    preview: string | null; - id товара в окне детального просмотра
    order: IOrder | null; - данные о заказе
}
`

#### Данные доставки:

`
interface IDeliveryForm {
    payment: string; - способ оплаты
    address: string; - адрес доставки
}
`

#### Контактные данные:

`
interface IContactForm {
    email: string; - электронная почта
    phone: string; - номер телефона
}
`

#### Данные всего заказа:

`
interface IOrder extends IDeliveryForm, IContactForm {
    total: number; - общая сумма заказа
    items: string[]; - id всех товаров в заказе
}
`

#### Данные ответа сервера на заказ:

`
interface IOrderResult {
    id: string; - id заказа
    total: number; - общая сумма заказа
}
`

#### Ошибки Форм:

`
type FormErrors = Partial<Record<keyof IOrder, string>>;
`

#### Данные для отображения карточки:

`
interface ICard extends IProduct {
    buttonTitle?: string; - textContent для кнопки покупки
}
`

#### Данные для отображения корзины:

`
interface IBasketView {
    items: HTMLElement[]; - список карточек в корзине
    total: number; - итоговая стоимость товаров в корзине
}
`

#### Данные для отображения главной страницы:

`
interface IPage {
    counter: number; - значение счетчика корзины
    catalog: HTMLElement[]; - список карточек в каталоге
}
`

#### Данные для отображения успешного заказа:

`
interface ISuccess {
    total: number; - итоговая стоимость товара
}
`

#### Действия, передаваемые в конструктор:

`
interface IActions {
    onClick: (event: MouseEvent) => void; - действие нажатия мышки
}
`

#### Действия, передаваемые в конструктор успешного заказа:

`
interface ISuccessActions {
    onClick: () => void; - любое действие
}
`

#### Список всех событий:

**каталог**

card:select - выбираем карточку из каталога

items:changed - меняем товар в каталоге

preview:changed - изменение окна превью

**товар**

product:add - добавляем товара в корзину

product:toggle - переключатель товара в корзине

product:delete = удаляем из корзины товары

**корзина**

basket:open - корзина: открытие окна

basket:changed - корзина: её изменение

counter:changed - счетчик корзины: изменение счетчика


**заказ**

order:open - открываем окно формы доставки

order:submit - отправка формы доставки

/^order\..*:change/ - изменение любого поля в форме доставки

delivery:ready - форма доставки готова к отправке

formErrors:change - изменение списка ошибок

**контакты**

contact:ready - форма контактов готова к отправке

contacts:submit - отправка формы контактов

/^contacts\..*:change/ - изменение любого поля формы контактов

**оплата**

payment:toggle - изменение способа оплаты

**модальное окно**

modal:open - открытие модального окна

modal:close - закрытие модального окна
